<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Testing &mdash; Herculeum 0.12.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.12.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Herculeum 0.12.0 documentation" href="../index.html" />
    <link rel="prev" title="Error Handling" href="error_handling.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="error_handling.html" title="Error Handling"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Herculeum 0.12.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>This section will have a look at various testing approaches utilised in the
writing of the game and how to add more tests.</p>
<div class="section" id="overview-of-testing">
<h2>Overview of testing<a class="headerlink" href="#overview-of-testing" title="Permalink to this headline">¶</a></h2>
<p>Tools currently in use are:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="https://github.com/nose-devs/nose/">nose</a></li>
<li><a class="reference external" href="http://docs.python.org/library/doctest.html">doctest</a></li>
<li><a class="reference external" href="http://pypi.python.org/pypi/behave">behave</a></li>
<li><a class="reference external" href="http://code.google.com/p/mockito-python/">mockito-python</a></li>
<li><a class="reference external" href="http://pypi.python.org/pypi/PyHamcrest">pyhamcrest</a></li>
</ul>
</div></blockquote>
<p>Nosetests are mainly used to help the design and development of the software.
They form nice safety net that catches bugs that might otherwise go unnoticed
for periods of time.</p>
<p>Doctest is used to ensure that code examples and snippets in documentation are
up to date.</p>
<p>Behave is used to write tests that are as close as possible to natural
language.</p>
<p>Additional tool called <a class="reference external" href="http://pypi.python.org/pypi/nosy">nosy</a> can be used to run nosetests automatically as
soon as any file change is detected. This is very useful when doing test
driven development.</p>
</div>
<div class="section" id="running-tests">
<h2>Running tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h2>
<div class="section" id="nose">
<h3>Nose<a class="headerlink" href="#nose" title="Permalink to this headline">¶</a></h3>
<p>Nose tests can be run by issuing following command in pyherc directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">nosetests</span>
</pre></div>
</div>
<p>It should output series of dots as tests are executed and summary in
the end:</p>
<div class="highlight-python"><pre>......................................................................
......................................................................
........................................
----------------------------------------------------------------------
Ran 180 tests in 3.992s</pre>
</div>
<p>If there are any problems with the tests (or the code they are testing),
error will be shown along with stack trace.</p>
</div>
<div class="section" id="doctest">
<h3>Doctest<a class="headerlink" href="#doctest" title="Permalink to this headline">¶</a></h3>
<p>Running doctest is as simple. Navigate to the directory containing make.bat
for documentation containing tests (doc/api/) and issue command:</p>
<div class="highlight-python"><pre>make doctest</pre>
</div>
<p>This will start sphinx and run the test. Results from each document are
displayed separately and finally summary will be shown:</p>
<div class="highlight-python"><pre>Doctest summary
===============
    4 tests
    0 failures in tests
    0 failures in setup code
    0 failuers in cleanup code
build succeeded.

Testing of doctests in the sources finished, look at the results in build/doctest/output.txt.</pre>
</div>
<p>Results are also saved into a file that is placed to build/doctest/ directory</p>
<p>There is handy shortcut in main directory that will execute both and also
gather test coverage metrics from nosetests:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">suite</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Coverage report is placed in cover - directory.</p>
</div>
<div class="section" id="behave">
<h3>Behave<a class="headerlink" href="#behave" title="Permalink to this headline">¶</a></h3>
<p>Navigate to directory containing tests written with behave (behave) and issue
command:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">behave</span>
</pre></div>
</div>
<p>This will start behave and run all tests. Results for each feature are
displayed on screen and finally a summary is shown:</p>
<div class="highlight-python"><pre>2 features passed, 0 failed, 0 skipped
3 scenarios passed, 0 failed, 0 skipped
21 steps passed, 0 failed, 0 skipped, 0 undefined
Took 0m0.0s</pre>
</div>
</div>
</div>
<div class="section" id="writing-tests">
<h2>Writing tests<a class="headerlink" href="#writing-tests" title="Permalink to this headline">¶</a></h2>
<div class="section" id="unit-tests">
<h3>Unit tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h3>
<p>Unit tests are placed in package <tt class="xref py py-mod docutils literal"><span class="pre">pyherc.test.unit</span></tt> Any module that is
named as &#8220;test_*&#8221; will be inspected automatically by Nose when it is gathering
tests to run. It will search for classes named &#8220;Test*&#8221; and methods named
&#8220;test_*&#8221;.</p>
<p>Following code is simple test that creates EffectHandle object and tries to
add it into EffectsCollection object. Then it verifies that it actually was
added there.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyherc.data.effects</span> <span class="kn">import</span> <span class="n">EffectsCollection</span>
<span class="kn">from</span> <span class="nn">pyherc.test.builders</span> <span class="kn">import</span> <span class="n">EffectHandleBuilder</span>
<span class="kn">from</span> <span class="nn">hamcrest</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyherc.test.matchers</span> <span class="kn">import</span> <span class="n">has_effect_handle</span>

<span class="k">class</span> <span class="nc">TestEffectsCollection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestEffectsCollection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup test case</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="n">EffectsCollection</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_adding_effect_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test that effect handle can be added and retrieved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="n">EffectHandleBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">add_effect_handle</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

        <span class="n">assert_that</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">,</span> <span class="n">has_effect_handle</span><span class="p">(</span><span class="n">handle</span><span class="p">))</span>

<span class="n">test_class</span> <span class="o">=</span> <span class="n">TestEffectsCollection</span><span class="p">()</span>
<span class="n">test_class</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
<span class="n">test_class</span><span class="o">.</span><span class="n">test_adding_effect_handle</span><span class="p">()</span>
</pre></div>
</div>
<p>Interesting parts of the test are especially the usage of EffectHandleBuilder
to create the EffectHandle object and the customer has_effect_handle matcher.</p>
<p>Builders are used because they make setting up objects easy, especially when
dealing with very complex objects (Character for example). They are placed
at <tt class="xref py py-mod docutils literal"><span class="pre">pyherc.test.builders</span></tt> module.</p>
<p>Custom matchers are used because they make dealing with verification somewhat
cleaner. If the internal implementation of class changes, we need to only
change how builders construct it and how matchers match it and tests should not
need any modifications. Custom matchers can be found at
<tt class="xref py py-mod docutils literal"><span class="pre">pyherc.test.matchers</span></tt> module.</p>
</div>
<div class="section" id="cutesy">
<h3>Cutesy<a class="headerlink" href="#cutesy" title="Permalink to this headline">¶</a></h3>
<p>Cutesy is an internal domain specific language. Basically, it&#8217;s just a
collection of functions that can be used to contruct nice looking tests. Theory
is that these easy to read tests can be used to communicate what the system
is supposed to be doing on a high level, without making things complicated
with all the technical details.</p>
<p>Here&#8217;s an example, how to test that getting hit will cause hit points to go
down.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyherc.test.cutesy</span> <span class="kn">import</span> <span class="n">strong</span><span class="p">,</span> <span class="n">Adventurer</span>
<span class="kn">from</span> <span class="nn">pyherc.test.cutesy</span> <span class="kn">import</span> <span class="n">weak</span><span class="p">,</span> <span class="n">Goblin</span>
<span class="kn">from</span> <span class="nn">pyherc.test.cutesy</span> <span class="kn">import</span> <span class="n">Level</span>

<span class="kn">from</span> <span class="nn">pyherc.test.cutesy</span> <span class="kn">import</span> <span class="n">place</span><span class="p">,</span> <span class="n">middle_of</span>
<span class="kn">from</span> <span class="nn">pyherc.test.cutesy</span> <span class="kn">import</span> <span class="n">right_of</span>
<span class="kn">from</span> <span class="nn">pyherc.test.cutesy</span> <span class="kn">import</span> <span class="n">make</span><span class="p">,</span>  <span class="n">hit</span>

<span class="kn">from</span> <span class="nn">hamcrest</span> <span class="kn">import</span> <span class="n">assert_that</span>
<span class="kn">from</span> <span class="nn">pyherc.test.cutesy</span> <span class="kn">import</span> <span class="n">has_less_hit_points</span>

<span class="k">class</span> <span class="nc">TestCombatBehaviour</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">test_hitting_reduces_hit_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Pete</span> <span class="o">=</span> <span class="n">strong</span><span class="p">(</span><span class="n">Adventurer</span><span class="p">())</span>
        <span class="n">Uglak</span> <span class="o">=</span> <span class="n">weak</span><span class="p">(</span><span class="n">Goblin</span><span class="p">())</span>

        <span class="n">place</span><span class="p">(</span><span class="n">Uglak</span><span class="p">,</span> <span class="n">middle_of</span><span class="p">(</span><span class="n">Level</span><span class="p">()))</span>
        <span class="n">place</span><span class="p">(</span><span class="n">Pete</span><span class="p">,</span> <span class="n">right_of</span><span class="p">(</span><span class="n">Uglak</span><span class="p">))</span>

        <span class="n">make</span><span class="p">(</span><span class="n">Uglak</span><span class="p">,</span> <span class="n">hit</span><span class="p">(</span><span class="n">Pete</span><span class="p">))</span>

        <span class="n">assert_that</span><span class="p">(</span><span class="n">Pete</span><span class="p">,</span> <span class="n">has_less_hit_points</span><span class="p">())</span>

<span class="n">test</span> <span class="o">=</span> <span class="n">TestCombatBehaviour</span><span class="p">()</span>
<span class="n">test</span><span class="o">.</span><span class="n">test_hitting_reduces_hit_points</span><span class="p">()</span>
</pre></div>
</div>
<p>Tests written with Cutesy follow same guidelines as regular unit tests. However
they are placed in package <tt class="xref py py-mod docutils literal"><span class="pre">pyherc.test.bdd</span></tt></p>
</div>
<div class="section" id="id1">
<h3>Doctest<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Doctest tests are written inside of .rst documents that are used to generate
documentation (including this one you are currently reading). These documents
are placed in doc/api/source folder and folders inside it.</p>
<p><tt class="docutils literal"><span class="pre">..</span> <span class="pre">testcode::</span></tt> Starts test code block. Code example is placed inside this
one.</p>
<p><tt class="docutils literal"><span class="pre">..</span> <span class="pre">testoutput::</span></tt> Is optional block. It can be omitted if it is enough to see
that the code example can be executed. If output of the example needs to be
verified, expected output is placed here.</p>
<p>Nosetest example earlier in this document is also a doctest example. If you
view source of this page, you can see how it has been constructed.</p>
<p>More information can be found at
<a class="reference external" href="http://sphinx.pocoo.org/ext/doctest.html">Sphinx documentation</a>.</p>
</div>
<div class="section" id="id2">
<h3>Behave<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Tests with behave are placed under directory behave/features. They consists of
two parts: feature-file specifying one or more test scenarios and python
implementation of steps in feature-files.</p>
<p>The earlier Cutesy example can be translated to behave as follows:</p>
<div class="highlight-python"><pre>Feature: Combat
  as an character
  in order to kill enemies
  I want to damage my enemies

  Scenario: hit in unarmed combat
     Given Pete is Adventurer
       And Uglak is Goblin
       And Uglak is standing in room
       And Pete is standing next to Uglak
      When Uglak hits Pete
      Then Pete should have less hitpoints</pre>
</div>
<p>Each of the steps need to be defined as Python code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@given</span><span class="p">(</span><span class="s">u&#39;{character_name} is Adventurer&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">impl</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">character_name</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s">&#39;characters&#39;</span><span class="p">):</span>
        <span class="n">context</span><span class="o">.</span><span class="n">characters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_character</span> <span class="o">=</span> <span class="n">Adventurer</span><span class="p">()</span>
    <span class="n">new_character</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">character_name</span>
    <span class="n">context</span><span class="o">.</span><span class="n">characters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_character</span><span class="p">)</span>
</pre></div>
</div>
<p>It is advisable not to reimplement all the logic in behave tests, but reuse
existing functionality from Cutesy. This makes tests both faster to write and
easier to maintain. For more information on using behave, have a look at their
online <a class="reference external" href="http://packages.python.org/behave/tutorial.html">tutorial</a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#overview-of-testing">Overview of testing</a></li>
<li><a class="reference internal" href="#running-tests">Running tests</a><ul>
<li><a class="reference internal" href="#nose">Nose</a></li>
<li><a class="reference internal" href="#doctest">Doctest</a></li>
<li><a class="reference internal" href="#behave">Behave</a></li>
</ul>
</li>
<li><a class="reference internal" href="#writing-tests">Writing tests</a><ul>
<li><a class="reference internal" href="#unit-tests">Unit tests</a></li>
<li><a class="reference internal" href="#cutesy">Cutesy</a></li>
<li><a class="reference internal" href="#id1">Doctest</a></li>
<li><a class="reference internal" href="#id2">Behave</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="error_handling.html"
                        title="previous chapter">Error Handling</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/guide/testing.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="error_handling.html" title="Error Handling"
             >previous</a> |</li>
        <li><a href="../index.html">Herculeum 0.12.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2014, Tuukka Turto.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>
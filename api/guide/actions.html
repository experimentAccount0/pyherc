<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Actions &mdash; Herculeum 0.13.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.13.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Herculeum 0.13.0 documentation" href="../index.html" />
    <link rel="next" title="Events" href="events.html" />
    <link rel="prev" title="Generating an item" href="generate_item.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="events.html" title="Events"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="generate_item.html" title="Generating an item"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Herculeum 0.13.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="actions">
<h1>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h1>
<p>This section will have a look at actions, how they are created and handled
during play and how to add new actions.</p>
<div class="section" id="overview-of-action-system">
<h2>Overview of Action system<a class="headerlink" href="#overview-of-action-system" title="Permalink to this headline">¶</a></h2>
<p>Actions are used to represent actions taken by characters. This include things
like moving, fighting and drinking potions. Every time an action is taken by
a character, new instance of Action class (or rather subclass of it) needs to
be created.</p>
</div>
<div class="section" id="action-creation-during-play">
<h2>Action creation during play<a class="headerlink" href="#action-creation-during-play" title="Permalink to this headline">¶</a></h2>
<p>Actions are instantiated via ActionFactory, by giving it correct parameter
class. For example, for character to move around, it can do it by:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_factory</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">MoveParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                       <span class="n">direction</span><span class="p">,</span>
                                                       <span class="s">&#39;walk&#39;</span><span class="p">))</span>
<span class="n">action</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<p>This creates a WalkAction and executes it, causing the character to take a
single step to given direction.</p>
</div>
<div class="section" id="adding-a-new-type-of-action">
<h2>Adding a new type of action<a class="headerlink" href="#adding-a-new-type-of-action" title="Permalink to this headline">¶</a></h2>
<p>Lets say we want to create an action that allows characters to wait for
specific amount of ticks.</p>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>Actions are located in <tt class="xref py py-mod docutils literal"><span class="pre">pyherc.rules</span></tt>. Custom is to have own package for
each type of action. For example, code related to moving is placed in
<tt class="xref py py-mod docutils literal"><span class="pre">pyherc.rules.move</span></tt> while code for various attacks is in
<tt class="xref py py-mod docutils literal"><span class="pre">pyherc.rules.attack</span></tt>. Parameter classes are placed to
<tt class="xref py py-mod docutils literal"><span class="pre">pyherc.rules.public</span></tt> and imported to top level for ease of use.</p>
<p>Last important piece is factory that knows how to read parameter class and
construct action class based on it. Factories are placed in the same location
as the actions.</p>
</div>
<div class="section" id="creating-a-sub-action-factory">
<h3>Creating a sub action factory<a class="headerlink" href="#creating-a-sub-action-factory" title="Permalink to this headline">¶</a></h3>
<p>Sub action factory is used to create specific types of actions. Start by
inheriting it and overriding type of action it can be used to construct:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyherc.rules.factory</span> <span class="kn">import</span> <span class="n">SubActionFactory</span>

<span class="k">class</span> <span class="nc">WaitFactory</span><span class="p">(</span><span class="n">SubActionFactory</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_type</span> <span class="o">=</span> <span class="s">&#39;wait&#39;</span>
</pre></div>
</div>
<p>Next we need to define factory method that can actually create our new action:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
    <span class="n">wait_time</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">wait_time</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">target</span>
    <span class="k">return</span> <span class="n">WaitAction</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">wait_time</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-new-parameter-class">
<h3>Defining new parameter class<a class="headerlink" href="#defining-new-parameter-class" title="Permalink to this headline">¶</a></h3>
<p>WaitParameters class is very simple, almost could do without it even:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">WaitParameters</span><span class="p">(</span><span class="n">ActionParameters</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">wait_time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_type</span> <span class="o">=</span> <span class="s">&#39;wait&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_time</span> <span class="o">=</span> <span class="n">wait_time</span>
</pre></div>
</div>
<p>Constructor takes two parameters: target who is character doing the waiting
and wait_time, which is amount of ticks to wait. action_type is used by the
factory system to determine which factory should be used to create action
based on parameter class. It should match to the action_type we defined in
WaitFactory constructor.</p>
</div>
<div class="section" id="creating-the-new-action">
<h3>Creating the new action<a class="headerlink" href="#creating-the-new-action" title="Permalink to this headline">¶</a></h3>
<p>WaitAction is not much more complex:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">WaitAction</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">wait_time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_time</span> <span class="o">=</span> <span class="n">wait_time</span>

    <span class="k">def</span> <span class="nf">is_legal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">tick</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_time</span>
</pre></div>
</div>
<p>Constructor is used to create a new instance of WaitAction, with given
Character and wait time.</p>
<p>is_legal can be called by system before trying to execute the action, in order
to see if it can be safely done. We did not place any validation logic there
this time, but one could check for example if the character is too excited to
wait.</p>
<p>Calling execute will trigger the action and in our case increment internal
timer of the character. This will effectively move his turn further in the
future.</p>
</div>
<div class="section" id="configuring-actionfactory">
<h3>Configuring ActionFactory<a class="headerlink" href="#configuring-actionfactory" title="Permalink to this headline">¶</a></h3>
<p><tt class="xref py py-class docutils literal"><span class="pre">pyherc.rules.public.ActionFactory</span></tt> needs to be configured in order it
to be able to create our new WaitAction. This is done in
<tt class="xref py py-class docutils literal"><span class="pre">pyherc.config.Configuration</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">wait_factory</span> <span class="o">=</span> <span class="n">WaitFactory</span><span class="p">()</span>

<span class="bp">self</span><span class="o">.</span><span class="n">action_factory</span> <span class="o">=</span> <span class="n">ActionFactory</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                                    <span class="p">[</span><span class="n">move_factory</span><span class="p">,</span>
                                    <span class="n">attack_factory</span><span class="p">,</span>
                                    <span class="n">drink_factory</span><span class="p">,</span>
                                    <span class="n">wait_factory</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-easy-to-use-interface">
<h3>Adding easy to use interface<a class="headerlink" href="#adding-easy-to-use-interface" title="Permalink to this headline">¶</a></h3>
<p>Last finishing step is to add easy to use method to Character class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticks</span><span class="p">,</span> <span class="n">action_factory</span><span class="p">):</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">action_factory</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">WaitParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                      <span class="n">ticks</span><span class="p">))</span>
    <span class="n">action</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we can have our character to wait for a bit, just by calling:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">player_character</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">action_factory</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice how we are passing ActionFactory from outside of Character objects,
instead of defining it as an attribute of Character. We do not want to inject
service objects into domain objects, because it would complicate saving and
loading later on.</p>
</div>
<div class="section" id="whole-code">
<h3>Whole code<a class="headerlink" href="#whole-code" title="Permalink to this headline">¶</a></h3>
<p>Below is shown the whole example of wait action and demonstration how it
changes value in character&#8217;s internal clock.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyherc.data</span> <span class="kn">import</span> <span class="n">Character</span><span class="p">,</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">pyherc.rules</span> <span class="kn">import</span> <span class="n">ActionFactory</span><span class="p">,</span> <span class="n">ActionParameters</span>
<span class="kn">from</span> <span class="nn">pyherc.rules.factory</span> <span class="kn">import</span> <span class="n">SubActionFactory</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">Random</span>

<span class="k">class</span> <span class="nc">WaitParameters</span><span class="p">(</span><span class="n">ActionParameters</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">wait_time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_type</span> <span class="o">=</span> <span class="s">&#39;wait&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_time</span> <span class="o">=</span> <span class="n">wait_time</span>

<span class="k">class</span> <span class="nc">WaitAction</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">wait_time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_time</span> <span class="o">=</span> <span class="n">wait_time</span>

    <span class="k">def</span> <span class="nf">is_legal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">tick</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_time</span>

<span class="k">class</span> <span class="nc">WaitFactory</span><span class="p">(</span><span class="n">SubActionFactory</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_type</span> <span class="o">=</span> <span class="s">&#39;wait&#39;</span>

    <span class="k">def</span> <span class="nf">get_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="n">wait_time</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">wait_time</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">target</span>
        <span class="k">return</span> <span class="n">WaitAction</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">wait_time</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
<span class="n">wait_factory</span> <span class="o">=</span> <span class="n">WaitFactory</span><span class="p">()</span>
<span class="n">action_factory</span> <span class="o">=</span> <span class="n">ActionFactory</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">,</span>
                               <span class="n">factories</span> <span class="o">=</span> <span class="p">[</span><span class="n">wait_factory</span><span class="p">])</span>
<span class="n">character</span> <span class="o">=</span> <span class="n">Character</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">action</span> <span class="o">=</span> <span class="n">character</span><span class="o">.</span><span class="n">create_action</span><span class="p">(</span><span class="n">WaitParameters</span><span class="p">(</span><span class="n">character</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                 <span class="n">action_factory</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;Ticks {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">character</span><span class="o">.</span><span class="n">tick</span><span class="p">))</span>
<span class="n">action</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Ticks after waiting {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">character</span><span class="o">.</span><span class="n">tick</span><span class="p">))</span>
</pre></div>
</div>
<p>The output shows how it is character&#8217;s turn to move (tick is 0), but after
executing wait action, the tick is 5.</p>
<div class="highlight-none"><div class="highlight"><pre>Ticks 0
Ticks after waiting 5
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Actions</a><ul>
<li><a class="reference internal" href="#overview-of-action-system">Overview of Action system</a></li>
<li><a class="reference internal" href="#action-creation-during-play">Action creation during play</a></li>
<li><a class="reference internal" href="#adding-a-new-type-of-action">Adding a new type of action</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#creating-a-sub-action-factory">Creating a sub action factory</a></li>
<li><a class="reference internal" href="#defining-new-parameter-class">Defining new parameter class</a></li>
<li><a class="reference internal" href="#creating-the-new-action">Creating the new action</a></li>
<li><a class="reference internal" href="#configuring-actionfactory">Configuring ActionFactory</a></li>
<li><a class="reference internal" href="#adding-easy-to-use-interface">Adding easy to use interface</a></li>
<li><a class="reference internal" href="#whole-code">Whole code</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="generate_item.html"
                        title="previous chapter">Generating an item</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="events.html"
                        title="next chapter">Events</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/guide/actions.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="events.html" title="Events"
             >next</a> |</li>
        <li class="right" >
          <a href="generate_item.html" title="Generating an item"
             >previous</a> |</li>
        <li><a href="../index.html">Herculeum 0.13.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2014, Tuukka Turto.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>